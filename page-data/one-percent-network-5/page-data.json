{"componentChunkName":"component---src-templates-blog-template-js","path":"/one-percent-network-5/","result":{"data":{"cur":{"id":"07e871a9-e296-5627-8e08-bb3702e64491","html":"<blockquote>\n<p>다음은 <em>성공과 실패를 결정하는 1%의 네트워크 원리</em> 를 읽고 정리한 내용입니다. 본 글은 CH3. 케이블의 앞은 LAN 기기였다_허브와 스위치, 라우터의 탐험입니다 🙌</p>\n</blockquote>\n<br>\n<br>\n<h2 id=\"🛺-story1-케이블과-리피터-허브-속을-신호가-흘러간다\" style=\"position:relative;\"><a href=\"#%F0%9F%9B%BA-story1-%EC%BC%80%EC%9D%B4%EB%B8%94%EA%B3%BC-%EB%A6%AC%ED%94%BC%ED%84%B0-%ED%97%88%EB%B8%8C-%EC%86%8D%EC%9D%84-%EC%8B%A0%ED%98%B8%EA%B0%80-%ED%9D%98%EB%9F%AC%EA%B0%84%EB%8B%A4\" aria-label=\"🛺 story1 케이블과 리피터 허브 속을 신호가 흘러간다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 [Story1] 케이블과 리피터, 허브 속을 신호가 흘러간다</h2>\n<h3 id=\"1-패킷-하나하나가-독립적으로-동작한다\" style=\"position:relative;\"><a href=\"#1-%ED%8C%A8%ED%82%B7-%ED%95%98%EB%82%98%ED%95%98%EB%82%98%EA%B0%80-%EB%8F%85%EB%A6%BD%EC%A0%81%EC%9C%BC%EB%A1%9C-%EB%8F%99%EC%9E%91%ED%95%9C%EB%8B%A4\" aria-label=\"1 패킷 하나하나가 독립적으로 동작한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 패킷 하나하나가 독립적으로 동작한다</h3>\n<ul>\n<li>케이블로 흘러간 패킷은 중계 장치를 경유해서 목적지에 도착한다.</li>\n<li>중계 장치는 데이터의 내용을 보지 않고 헤더에 적힌 정보만 보고 중계한다.</li>\n<li>기본적인 흐름은 LAN 어댑터 → 리피터 허브 → 스위칭 허브 → 라우터를 경유해서 인터넷으로 나가는 것이다.</li>\n</ul>\n<h3 id=\"2-lan-케이블은-신호를-약화시키지-않는-것이-핵심이다\" style=\"position:relative;\"><a href=\"#2-lan-%EC%BC%80%EC%9D%B4%EB%B8%94%EC%9D%80-%EC%8B%A0%ED%98%B8%EB%A5%BC-%EC%95%BD%ED%99%94%EC%8B%9C%ED%82%A4%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%83%EC%9D%B4-%ED%95%B5%EC%8B%AC%EC%9D%B4%EB%8B%A4\" aria-label=\"2 lan 케이블은 신호를 약화시키지 않는 것이 핵심이다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다</h3>\n<ul>\n<li>LAN 어댑터의 PHY(MAU)회로에서 신호가 나가 케이블에 흘러 리피터 허브의 커넥터 부분에 도착한다.</li>\n<li>이때 케이블을 이동하고 그 길이가 길어지면서 신호가 약해져서 변형된다.</li>\n</ul>\n<h3 id=\"3-꼼은-잡음을-방지하기-위한-방법이다\" style=\"position:relative;\"><a href=\"#3-%EA%BC%BC%EC%9D%80-%EC%9E%A1%EC%9D%8C%EC%9D%84-%EB%B0%A9%EC%A7%80%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%B0%A9%EB%B2%95%EC%9D%B4%EB%8B%A4\" aria-label=\"3 꼼은 잡음을 방지하기 위한 방법이다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 꼼은 잡음을 방지하기 위한 방법이다.</h3>\n<ul>\n<li>선을 꼬게 되면서 전자파에 의한 잡음을 상쇄한다.</li>\n</ul>\n<h3 id=\"4-리피터-허브는-연결되어-있는-전체-케이블에-신호를-송신한다\" style=\"position:relative;\"><a href=\"#4-%EB%A6%AC%ED%94%BC%ED%84%B0-%ED%97%88%EB%B8%8C%EB%8A%94-%EC%97%B0%EA%B2%B0%EB%90%98%EC%96%B4-%EC%9E%88%EB%8A%94-%EC%A0%84%EC%B2%B4-%EC%BC%80%EC%9D%B4%EB%B8%94%EC%97%90-%EC%8B%A0%ED%98%B8%EB%A5%BC-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\" aria-label=\"4 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다</h3>\n<ul>\n<li>신호가 리피터 허브에 도착하면 LAN 전체에 신호가 흩어진다.</li>\n<li>신호를 수신한 기기는 맨 앞의 MAC 헤더에 쓰인 수신처 MAC 주소를 확인하고 자신이 아니면 무시한다.</li>\n<li>이 다음 스위칭 허브, 라우터, 서버 등에 도착해서 디지털 데이터로 변환되고, FCS를 검사하는 곳에서 오류가 나면 패킷을 폐기한다.</li>\n</ul>\n<br>\n<h2 id=\"🛺-story2-스위칭-허브의-패킷-중계-동작\" style=\"position:relative;\"><a href=\"#%F0%9F%9B%BA-story2-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EC%9D%98-%ED%8C%A8%ED%82%B7-%EC%A4%91%EA%B3%84-%EB%8F%99%EC%9E%91\" aria-label=\"🛺 story2 스위칭 허브의 패킷 중계 동작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 [Story2] 스위칭 허브의 패킷 중계 동작</h2>\n<h3 id=\"1-스위칭-허브는-주소-테이블로-중계한다\" style=\"position:relative;\"><a href=\"#1-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EB%8A%94-%EC%A3%BC%EC%86%8C-%ED%85%8C%EC%9D%B4%EB%B8%94%EB%A1%9C-%EC%A4%91%EA%B3%84%ED%95%9C%EB%8B%A4\" aria-label=\"1 스위칭 허브는 주소 테이블로 중계한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 스위칭 허브는 주소 테이블로 중계한다</h3>\n<ul>\n<li>트위스트 페어 케이블에서 흘러온 전기 신호가 PHY(MAU)회로를 거쳐 MAC 회로로 들어온다.</li>\n<li>MAC 회로에서 디지털 데이터(0101로 이루어진 데이터)로 변환되고 FCS를 대조하여 오류 유무를 검사하여 문제가 없다면 메모리 버퍼에 저장한다.</li>\n<li>\n<p>스위치 허브의 안쪽에는 <strong>포트</strong>가 있다.</p>\n<ul>\n<li>하나의 호스트에 각각의 LAN 어댑터가 있는 것과 같이 여러개의 포트가 존재한다.</li>\n<li>하지만 LAN 어댑터와는 달리 여기에는 각각 부여된 MAC 주소는 없다. 자기에게 할당된 패킷을 걸러서 받는 것이 아니라 모든 패킷을 수신하기 때문에 자신에게 부여된 MAC 주소가 필요 없다.</li>\n</ul>\n</li>\n<li>메모리 버퍼에 저장한 후 <strong>MAC 주소표</strong>에 수신한 패킷의 <strong>수신처 MAC 주소</strong>와 일치하는 정보가 있는지 확인한다. 이 표에는 MAC주소와 포트가 짝지어져 있다.</li>\n<li>\n<p>존재한다면 해당 포트 번호로 패킷을 보낸다. 해당 포트가 송신처 포트 번호가 된다.</p>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543967-e04b241e-dca0-4e5f-ac00-1bce0e4448b4.png\"><br>출처: 상위 1% 네트워크</p>\n</li>\n<li>스위치 회로는 격자 모양의 배치로 교점에 스위치가 있어 개폐를 제어할 수 있기 때문에 복수의 신호를 동시에 흘릴 수 있다.</li>\n<li>\n<p>실제로 패킷을 송신하는 PHY(MAU) 회로에서 케이블로 신호가 흘러가는데 이때는 이더넷의 규칙에 따라 아무도 송신하고 있지 않는 것을 확인하고 디지털 데이터를 신호로 변환하여 송신한다.</p>\n<ul>\n<li>LAN 어댑터와 마찬가지로 동시에 수신을 하게 되면 재밍 신호를 보낸 후 기다렸다가 재송신한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-mac-주소-테이블을-등록-및-갱신한다\" style=\"position:relative;\"><a href=\"#2-mac-%EC%A3%BC%EC%86%8C-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EB%93%B1%EB%A1%9D-%EB%B0%8F-%EA%B0%B1%EC%8B%A0%ED%95%9C%EB%8B%A4\" aria-label=\"2 mac 주소 테이블을 등록 및 갱신한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. MAC 주소 테이블을 등록 및 갱신한다</h3>\n<p>이 때 스위칭 허브는 MAC 주소표의 내용을 갱신해야 한다. </p>\n<ul>\n<li>\n<p>패킷을 수신했을 때 송신처 MAC 주소를 조사하여 수신한 입력 포트와 함께 주소표에 등록한다.</p>\n<ul>\n<li>따라서 한번이라도 패킷을 송신하면 MAC 주소가 주소표에 등록된다.</li>\n</ul>\n</li>\n<li>일정 시간이 지나면 오래된 MAC 주소 정보는 삭제한다. (더이상 유효하지 않을 수 있기 때문이다)</li>\n<li>잘못된 주소로 인해 패킷 통신 동작에 오류가 생기면 스위칭 허브를 리셋하여 MAC 주소를 초기화시키고 다시 주소가 등록되도록 하면 된다.</li>\n<li>\n<p>스위칭 허브 자체가 알아서 MAC 주소를 등록하므로 수동으로 갱신 및 등록 할 필요가 없다.</p>\n<ul>\n<li>스스로 등록, 삭제, 리셋을 한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3-예외적인-동작\" style=\"position:relative;\"><a href=\"#3-%EC%98%88%EC%99%B8%EC%A0%81%EC%9D%B8-%EB%8F%99%EC%9E%91\" aria-label=\"3 예외적인 동작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 예외적인 동작</h3>\n<ul>\n<li>\n<p>스위칭 허브에 리피터 허브가 접속되어 있는 경우 패킷이 수신된 포트와 송신할 포트가 같을 수 있다.</p>\n<ul>\n<li>상황1 - A 에서 B로 패킷을 보낸다.</li>\n<li>상황2 - 리피터 허브에 A, B, 스위치 허브가 연결되어 있다.</li>\n<li>문제 - 리피터 허브에서 전체 중계할 때 B, 스위치 허브에 모두 패킷이 간다. 이때 B 에게 패킷이 도착한다. 하지만 스위치 허브에서도 패킷을 받아서 중계하기 때문에 중복된 패킷이 B에게 도착한다.</li>\n<li>위 문제를 방지하기 위해 스위칭 허브는 수신한 포트와 송신하는 포트가 같을 경우 패킷을 중계하지 않고 폐기한다.</li>\n</ul>\n</li>\n<li>\n<p>최초이거나 삭제된 이후라서 MAC 주소표에 MAC 주소가 등록되어 있지 않은 경우가 있다.</p>\n<ul>\n<li>패킷을 수신한 포트를 제외한 모든 포트에서 패킷을 송신한다. (이 중 하나는 올바른 포트 이므로 패킷이 잘 송신된다)</li>\n<li>잘 송신한 이후 응답이 오면 해당 MAC 주소가 주소표에 등록이 되므로 그 다음 부터는 전체에게 보내지 않아도 된다.</li>\n</ul>\n</li>\n<li>수신처 MAC 주소가 브로드캐스트 주소인 경우 수신 포트를 제외하고 모든 포트에서 패킷을 송신한다.</li>\n</ul>\n<h3 id=\"4-전이중-모드에서-송신과-수신을-동시에-실행한다\" style=\"position:relative;\"><a href=\"#4-%EC%A0%84%EC%9D%B4%EC%A4%91-%EB%AA%A8%EB%93%9C%EC%97%90%EC%84%9C-%EC%86%A1%EC%8B%A0%EA%B3%BC-%EC%88%98%EC%8B%A0%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%9C%EB%8B%A4\" aria-label=\"4 전이중 모드에서 송신과 수신을 동시에 실행한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 전이중 모드에서 송신과 수신을 동시에 실행한다</h3>\n<ul>\n<li>스위칭 허브는 송신과 수신을 동시에 실행할 수 있는 <strong>전이중 모드</strong>다.</li>\n<li>스위칭 허브의 포트, PHY(MAU), MAC 회로 내부가 모두 송신과 수신이 나뉘어져 있다.</li>\n</ul>\n<h3 id=\"5-최적의-전송-속도로-보내는-자동-조정\" style=\"position:relative;\"><a href=\"#5-%EC%B5%9C%EC%A0%81%EC%9D%98-%EC%A0%84%EC%86%A1-%EC%86%8D%EB%8F%84%EB%A1%9C-%EB%B3%B4%EB%82%B4%EB%8A%94-%EC%9E%90%EB%8F%99-%EC%A1%B0%EC%A0%95\" aria-label=\"5 최적의 전송 속도로 보내는 자동 조정 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. 최적의 전송 속도로 보내는 자동 조정</h3>\n<p>접속 상대가 전이중 모드를 지원하는지 검출하여 동작 모드를 자동으로 전환하고 상대의 속도도 검출한다.</p>\n<h3 id=\"6-스위칭-허브는-복수의-중계-동작을-동시에-실행한다\" style=\"position:relative;\"><a href=\"#6-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EB%8A%94-%EB%B3%B5%EC%88%98%EC%9D%98-%EC%A4%91%EA%B3%84-%EB%8F%99%EC%9E%91%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%9C%EB%8B%A4\" aria-label=\"6 스위칭 허브는 복수의 중계 동작을 동시에 실행한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다</h3>\n<ul>\n<li>MAC 주소가 존재하는 포트 이외의 포트는 빈 포트가 되어 송신 동작을 하지 않는다.</li>\n<li>이 비어있는 포트에 별도의 패킷을 흘려 동시에 여러개의 패킷을 중계할 수 있다.</li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%F0%9F%9B%BA-story1-%EC%BC%80%EC%9D%B4%EB%B8%94%EA%B3%BC-%EB%A6%AC%ED%94%BC%ED%84%B0-%ED%97%88%EB%B8%8C-%EC%86%8D%EC%9D%84-%EC%8B%A0%ED%98%B8%EA%B0%80-%ED%9D%98%EB%9F%AC%EA%B0%84%EB%8B%A4\">🛺 Story1 케이블과 리피터, 허브 속을 신호가 흘러간다</a></p>\n<ul>\n<li><a href=\"#1-%ED%8C%A8%ED%82%B7-%ED%95%98%EB%82%98%ED%95%98%EB%82%98%EA%B0%80-%EB%8F%85%EB%A6%BD%EC%A0%81%EC%9C%BC%EB%A1%9C-%EB%8F%99%EC%9E%91%ED%95%9C%EB%8B%A4\">1. 패킷 하나하나가 독립적으로 동작한다</a></li>\n<li><a href=\"#2-lan-%EC%BC%80%EC%9D%B4%EB%B8%94%EC%9D%80-%EC%8B%A0%ED%98%B8%EB%A5%BC-%EC%95%BD%ED%99%94%EC%8B%9C%ED%82%A4%EC%A7%80-%EC%95%8A%EB%8A%94-%EA%B2%83%EC%9D%B4-%ED%95%B5%EC%8B%AC%EC%9D%B4%EB%8B%A4\">2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다</a></li>\n<li><a href=\"#3-%EA%BC%BC%EC%9D%80-%EC%9E%A1%EC%9D%8C%EC%9D%84-%EB%B0%A9%EC%A7%80%ED%95%98%EA%B8%B0-%EC%9C%84%ED%95%9C-%EB%B0%A9%EB%B2%95%EC%9D%B4%EB%8B%A4\">3. 꼼은 잡음을 방지하기 위한 방법이다.</a></li>\n<li><a href=\"#4-%EB%A6%AC%ED%94%BC%ED%84%B0-%ED%97%88%EB%B8%8C%EB%8A%94-%EC%97%B0%EA%B2%B0%EB%90%98%EC%96%B4-%EC%9E%88%EB%8A%94-%EC%A0%84%EC%B2%B4-%EC%BC%80%EC%9D%B4%EB%B8%94%EC%97%90-%EC%8B%A0%ED%98%B8%EB%A5%BC-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\">4. 리피터 허브는 연결되어 있는 전체 케이블에 신호를 송신한다</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%F0%9F%9B%BA-story2-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EC%9D%98-%ED%8C%A8%ED%82%B7-%EC%A4%91%EA%B3%84-%EB%8F%99%EC%9E%91\">🛺 Story2 스위칭 허브의 패킷 중계 동작</a></p>\n<ul>\n<li><a href=\"#1-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EB%8A%94-%EC%A3%BC%EC%86%8C-%ED%85%8C%EC%9D%B4%EB%B8%94%EB%A1%9C-%EC%A4%91%EA%B3%84%ED%95%9C%EB%8B%A4\">1. 스위칭 허브는 주소 테이블로 중계한다</a></li>\n<li><a href=\"#2-mac-%EC%A3%BC%EC%86%8C-%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%84-%EB%93%B1%EB%A1%9D-%EB%B0%8F-%EA%B0%B1%EC%8B%A0%ED%95%9C%EB%8B%A4\">2. MAC 주소 테이블을 등록 및 갱신한다</a></li>\n<li><a href=\"#3-%EC%98%88%EC%99%B8%EC%A0%81%EC%9D%B8-%EB%8F%99%EC%9E%91\">3. 예외적인 동작</a></li>\n<li><a href=\"#4-%EC%A0%84%EC%9D%B4%EC%A4%91-%EB%AA%A8%EB%93%9C%EC%97%90%EC%84%9C-%EC%86%A1%EC%8B%A0%EA%B3%BC-%EC%88%98%EC%8B%A0%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%9C%EB%8B%A4\">4. 전이중 모드에서 송신과 수신을 동시에 실행한다</a></li>\n<li><a href=\"#5-%EC%B5%9C%EC%A0%81%EC%9D%98-%EC%A0%84%EC%86%A1-%EC%86%8D%EB%8F%84%EB%A1%9C-%EB%B3%B4%EB%82%B4%EB%8A%94-%EC%9E%90%EB%8F%99-%EC%A1%B0%EC%A0%95\">5. 최적의 전송 속도로 보내는 자동 조정</a></li>\n<li><a href=\"#6-%EC%8A%A4%EC%9C%84%EC%B9%AD-%ED%97%88%EB%B8%8C%EB%8A%94-%EB%B3%B5%EC%88%98%EC%9D%98-%EC%A4%91%EA%B3%84-%EB%8F%99%EC%9E%91%EC%9D%84-%EB%8F%99%EC%8B%9C%EC%97%90-%EC%8B%A4%ED%96%89%ED%95%9C%EB%8B%A4\">6. 스위칭 허브는 복수의 중계 동작을 동시에 실행한다</a></li>\n</ul>\n</li>\n</ul>\n</div>","excerpt":"다음은 성공과 실패를 결정하는 1%의 네트워크 원리 를 읽고 정리한 내용입니다. 본 글은 CH3. 케이블의 앞은 LAN 기기였다_허브와 스위치, 라우터의 탐험입니다 🙌 🛺 Story1 케이블과 리피터, 허브 속을 신호가 흘러간다 1. 패킷 하나하나가 독립적으로 동작한다 케이블로 흘러간 패킷은 중계 장치를 경유해서 목적지에 도착한다. 중계 장치는 데이터의 내용을 보지 않고 헤더에 적힌 정보만 보고 중계한다. 기본적인 흐름은 LAN 어댑터 → 리피터 허브 → 스위칭 허브 → 라우터를 경유해서 인터넷으로 나가는 것이다. 2. LAN 케이블은 신호를 약화시키지 않는 것이 핵심이다 LAN 어댑터의 PHY(MAU)회로에서 신호가 나가 케이블에 흘러 리피터 허브의 커넥터 부분에 도착한다. 이때 케이블을 이동하고 그 길이가 길어지면서 신호가 약해져서 변형된다. 3. 꼼은 잡음을 방지하기 위한 방법이다. 선을 꼬게 되면서 전자파에 의한 잡음을 상쇄한다. 4. 리피터 허브는 연결되어 있는 전체 케이…","frontmatter":{"date":"October 01, 2021","title":"성공과 실패를 결정하는 1%의 네트워크 원리_5","categories":"네트워크 책","author":"코다","emoji":"⚡️"},"fields":{"slug":"/one-percent-network-5/"}},"next":{"id":"a180f961-5ad2-56c5-99c8-ed17112b0314","html":"<blockquote>\n<p>다음은 <em>성공과 실패를 결정하는 1%의 네트워크 원리</em> 를 읽고 정리한 내용입니다. 본 글은 CH2. TCP/IP의 데이터를 전기 신호로 만들어 보낸다_프로토콜 스택과 LAN 어댑터의 탐험입니다 🙌</p>\n</blockquote>\n<br>\n<br>\n<h2 id=\"🛺-story4-서버에서-연결을-끊어-소켓을-말소한다\" style=\"position:relative;\"><a href=\"#%F0%9F%9B%BA-story4-%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-%EC%97%B0%EA%B2%B0%EC%9D%84-%EB%81%8A%EC%96%B4-%EC%86%8C%EC%BC%93%EC%9D%84-%EB%A7%90%EC%86%8C%ED%95%9C%EB%8B%A4\" aria-label=\"🛺 story4 서버에서 연결을 끊어 소켓을 말소한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 [Story4] 서버에서 연결을 끊어 소켓을 말소한다</h2>\n<h3 id=\"1-데이터-보내기를-완료하고-연결을-끊는다\" style=\"position:relative;\"><a href=\"#1-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B3%B4%EB%82%B4%EA%B8%B0%EB%A5%BC-%EC%99%84%EB%A3%8C%ED%95%98%EA%B3%A0-%EC%97%B0%EA%B2%B0%EC%9D%84-%EB%81%8A%EB%8A%94%EB%8B%A4\" aria-label=\"1 데이터 보내기를 완료하고 연결을 끊는다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 데이터 보내기를 완료하고 연결을 끊는다</h3>\n<ul>\n<li>소켓 연결 말소 시점은 한쪽이 데이터 보내기를 완료했을때다.</li>\n<li>\n<p>어느 측에서든 먼저 연결을 끊을 수 있도록 프로토콜이 설계 되어 있다.</p>\n<ul>\n<li>주로 브라우저에서 요청을 보내고 서버에서 응답을 하면 서버 측에서 먼저 연결 끊기 동작을 실행한다.</li>\n</ul>\n</li>\n<li><code class=\"language-text\">close</code> 메소드를 호출해서 연결끊기 동작에 들어간다.</li>\n<li>\n<p>연결끊기 동작 세부 로직 - 끊는 쪽 (예. 서버)</p>\n<ul>\n<li>연결을 끊고자 하는 측이 TCP 헤더를 만들어서 FIN 컨트롤 비트를 1로 설정한다.</li>\n<li>이 패킷을 IP 담당에게 요청하여 상대에게 송신한다.</li>\n<li>자신의 소켓에 연결 끊기 동작에 들어갔다는 사실을 통지한다.</li>\n</ul>\n</li>\n<li>\n<p>연결끊기 동작 세부 로직 - 상대 쪽 (예. 브라우저)</p>\n<ul>\n<li>프로토콜 스택이 소켓에 연결 끊기 동작이 들어갔다는 것을 기록하고 패킷을 잘 받았다는 뜻으로 ACK를 보낸다.</li>\n<li>어플리케이션이 <code class=\"language-text\">read</code>를 할 때 데이터를 건내는 대신 데이터 수신을 완료했음을 알리고 FIN을 1로 한 헤더를 IP 담당에게 넘겨 반송한다.</li>\n<li>서버에서 ACK를 보내면 연결이 끊기가 완료된다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"2-소켓을-말소한다\" style=\"position:relative;\"><a href=\"#2-%EC%86%8C%EC%BC%93%EC%9D%84-%EB%A7%90%EC%86%8C%ED%95%9C%EB%8B%A4\" aria-label=\"2 소켓을 말소한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 소켓을 말소한다</h3>\n<ul>\n<li>\n<p>연결 끊기 동식이 실행되었을 때 소켓을 곧바로 말소하지 않고 기다린 후에 소켓을 말소한다.</p>\n<ul>\n<li>이유는 ACK가 서버에 도착하지 않아서 서버가 다시 FIN을 전송하게 되는 경우 담당 소켓이 말소되었으므로 동일한 포트번호의 새로운 소켓을 생성하게 되고 해당 소켓에 FIN이 도착하여 오동작하게 된다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"3-데이터-송수신-동작-요약\" style=\"position:relative;\"><a href=\"#3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91-%EC%9A%94%EC%95%BD\" aria-label=\"3 데이터 송수신 동작 요약 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 데이터 송수신 동작 요약</h3>\n<ul>\n<li>처음 소켓을 작성한다. (보통 서버측에서 먼저 소켓을 만들고 접속 대기 상태로 기다린다)</li>\n<li>\n<p>클라이언트에서도 소켓을 만들고 서버로 접속 동작을 실행한다.</p>\n<ul>\n<li>SYN을 1로 만들고 TCP 헤더를 만들어서 서버에 보낸다. (시퀀스 초기값, 윈도우 값도 포함)</li>\n<li>서버에서 ACK 번호, 윈도우값, SYN 1, 시퀀스 초기값을 전송한다.</li>\n<li>클라이언트에서 ACK 번호를 보낸다.</li>\n</ul>\n</li>\n<li>\n<p>데이터를 송수신 한다.</p>\n<ul>\n<li>웹의 경우 클라이언트가 요청 메세지를 보내는 것을 시작한다.</li>\n<li>TCP는 최대 MSS 만큼 패킷을 분할 + 헤더 추가하여 보낸다.</li>\n<li>시퀀스 번호와 데이터를 보내면 상대는 ACK 번호와 윈도우 값을 보낸다.</li>\n<li>슬라이등 윈도우 기법으로 흐름제어를 한다.</li>\n</ul>\n</li>\n<li>\n<p>연결을 끊는다.</p>\n<ul>\n<li>웹의 경우 서버가 먼저 연결 끊기 동작을 실행한다.</li>\n<li>FIN 1로 만든 헤더를 보내고 ACK 번호를 응답으로 받는다.</li>\n<li>이후 상대도 FIN 1로 만든 헤더를 보내고 ACK를 응답으로 받는다.</li>\n<li>잠시 기다린 후 소켓을 말소한다.</li>\n</ul>\n</li>\n</ul>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543869-4a228252-e6e4-413b-bedb-096c07364266.png\"><br>출처: 상위 1% 네트워크</p>\n<br>\n<h2 id=\"🛺-story5-ip와-이더넷의-패킷-송수신-동작\" style=\"position:relative;\"><a href=\"#%F0%9F%9B%BA-story5-ip%EC%99%80-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9D%98-%ED%8C%A8%ED%82%B7-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91\" aria-label=\"🛺 story5 ip와 이더넷의 패킷 송수신 동작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 [Story5] IP와 이더넷의 패킷 송수신 동작</h2>\n<ul>\n<li>TCP 담당 부분에서 필요한 헤더 및 데이터를 추가한 이후에 IP 담당 부분에게 의뢰한다.</li>\n</ul>\n<h3 id=\"1-패킷의-기본\" style=\"position:relative;\"><a href=\"#1-%ED%8C%A8%ED%82%B7%EC%9D%98-%EA%B8%B0%EB%B3%B8\" aria-label=\"1 패킷의 기본 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 패킷의 기본</h3>\n<ul>\n<li>\n<p>패킷은 헤더 + 데이터로 나뉜다. (주소 등의 제어 정보 + 안의 내용물)</p>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543891-a6fa10df-b371-4f35-97a5-7c2001b22910.png\"><br>출처: 상위 1% 네트워크</p>\n</li>\n<li>\n<p>패킷의 흐름은 패킷의 헤더에 적힌 제어정보와 중계 장치에 있는 표의 정보를 결합하여 다음 패킷 목적지로 이동하며 최종 목적지에 도착한다.</p>\n<ul>\n<li>송신처와 최송 수신처를 ‘엔드 노드’라고 부른다.</li>\n</ul>\n</li>\n</ul>\n<h4 id=\"tcpip-에서-패킷-구조\" style=\"position:relative;\"><a href=\"#tcpip-%EC%97%90%EC%84%9C-%ED%8C%A8%ED%82%B7-%EA%B5%AC%EC%A1%B0\" aria-label=\"tcpip 에서 패킷 구조 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>TCP/IP 에서 패킷 구조</h4>\n<p>두 가지 중계 장치가 있다. 서브넷을 관리하는 ‘허브’와 IP를 담당하는 ‘라우터’이다. </p>\n<p>각각 다음 역할을 한다. </p>\n<ul>\n<li>\n<p>라우터가 목적지를 확인하여 다음 라우터를 찾는다.</p>\n<ul>\n<li>IP가 다음 목적지를 확인하여 다음 IP 중계 장치를 찾는다.</li>\n</ul>\n</li>\n<li>\n<p>허브가 서브넷 안에서 패킷을 운반해 다음 라우터에 도착하도록 한다.</p>\n<ul>\n<li>서브넷 안의 이더넷이 라우터까지 패킷을 운반한다.</li>\n</ul>\n</li>\n</ul>\n<p>위 역할을 수행하기 위해서 패킷에 다음 두 헤더가 붙어 있다. </p>\n<ol>\n<li>MAC 헤더 (이더넷용 헤더)</li>\n<li>IP 헤더 (IP용 헤더) </li>\n<li>\n<p>패킷 운반 흐름은 다음과 같다.</p>\n<ul>\n<li>먼저 클라이언트가 TCP 헤더 + 데이터를 이어붙이고 목적 IP 주소에 맞는 다음 라우터를 조사한다.</li>\n<li>다음 라우터가 정해지면 해당 라우터에 대한 MAC 주소를 조사하고 패킷의 MAC 헤더에 추가한다.</li>\n<li>이더넷에게 해당 라우터로 패킷을 전송하도록 의뢰하여 패킷을 송신한다.</li>\n<li>\n<p>이더넷에 의해 허브에 도착한다. 허브에서 이더넷 표와 헤더 정보를 결합해서 다음 라우터로 중계한다.</p>\n<ul>\n<li>만일 허브가 여러개라면 여러 허브를 순차적으로 경우한다.</li>\n</ul>\n</li>\n<li>\n<p>다음 라우터에 도착해서 IP용 표를 통해 다음 라우터를 조사하여 MAC 주소를 헤더가 기록한다.</p>\n<ul>\n<li>동일하게 허브를 경유하여 다음 라우터에 도착한다. 수신처에 도착할 때까지 반복한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n</ol>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543896-57e300fe-ae57-4d72-9638-387b2acdd4cd.png\"><br>출처: 상위 1% 네트워크</p>\n<ul>\n<li>\n<p>이더넷 대신 무선 LAN, ADSL 등으로 대체될 수 있다.</p>\n<ul>\n<li><strong>IP의 의뢰를 받아서 패킷을 운반할 수 있는 것이면 된다.</strong></li>\n</ul>\n</li>\n<li>여기까지가 전체적인 흐름!!</li>\n</ul>\n<h3 id=\"2-패킷-송수신-동작의-개요\" style=\"position:relative;\"><a href=\"#2-%ED%8C%A8%ED%82%B7-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91%EC%9D%98-%EA%B0%9C%EC%9A%94\" aria-label=\"2 패킷 송수신 동작의 개요 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 패킷 송수신 동작의 개요</h3>\n<p>IP 담당이 진행하는 패킷 송신 동작을 자세하게 알아보기! IP 담당은 패킷을 송출하고 실제 패킷의 운반은 네트워크 기기인 허브 및 라우터가 수행한다. </p>\n<ul>\n<li>TCP 담당에서 TCP 헤더와 데이터가 붙은 채로 IP 담당에게 넘어온다.</li>\n<li>\n<p>IP 담당은 넘어온 패킷을 들여다보지 않고 단지 헤더를 추가한다.</p>\n<ul>\n<li>IP 헤더와 MAC 헤더를 추가한다.</li>\n</ul>\n</li>\n<li>IP 헤더: 목적지를 나타내는 제어정보</li>\n<li>MAC 헤더: LAN을 사용해서 가까운 라우터까지 패킷을 운반할 때 사용할 제어정보</li>\n<li>\n<p>완성된 패킷을 네트워크 <strong>하드웨어</strong> LAN 어댑터에 보낸다.</p>\n<ul>\n<li>0과 1로 이루어진 디지털 데이터의 모습이다.</li>\n<li>LAN 어댑터는 전기나 빛의 신호로 바꾸어 케이블로 송출한다.</li>\n<li>이후 허브나 라우터 등의 중계 장치에 도착한다.</li>\n</ul>\n</li>\n<li>IP 담당에서 바라보는 패킷은 그 역할이 구분되어 있지 않고 단순히 ‘패킷’이라는 덩어리일 뿐이다. 패킷의 내용, 순서, 유무도 상관하지 않는다.</li>\n</ul>\n<h3 id=\"3-수신처-ip주소를-기록한-ip-헤더를-만든다\" style=\"position:relative;\"><a href=\"#3-%EC%88%98%EC%8B%A0%EC%B2%98-ip%EC%A3%BC%EC%86%8C%EB%A5%BC-%EA%B8%B0%EB%A1%9D%ED%95%9C-ip-%ED%97%A4%EB%8D%94%EB%A5%BC-%EB%A7%8C%EB%93%A0%EB%8B%A4\" aria-label=\"3 수신처 ip주소를 기록한 ip 헤더를 만든다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 수신처 IP주소를 기록한 IP 헤더를 만든다</h3>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543901-4a6f5980-cbc5-48d2-bc86-ac8518ba3457.png\"><br>출처: 상위 1% 네트워크</p>\n<ul>\n<li>수신처 IP주소 → 어플리케이션에서 통지한 그대로를 사용</li>\n<li>송신처 IP주소 → 여러 LAN 어댑터 중 송신을 책임지는 어댑터(대상 라우터가 정해지면 정해짐)의 IP 주소 사용</li>\n</ul>\n<h4 id=\"ip-경로표\" style=\"position:relative;\"><a href=\"#ip-%EA%B2%BD%EB%A1%9C%ED%91%9C\" aria-label=\"ip 경로표 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>IP 경로표</h4>\n<ul>\n<li>\n<p><code class=\"language-text\">route print</code> 로 경로표를 확인할 수 있다.</p>\n<ul>\n<li>\n<p>수신처 IP 주소의 왼쪽 부분이 일치하면 해당하는 행의 정보가 알맞은 것이다.</p>\n<ul>\n<li>예를 들어 수신처 IP가 10.10.1.166 이면 왼쪽이 일치하는 10.10.1이 알맞은 행이다.</li>\n<li>Interface로 네트워크용(LAN 어댑터) 인터페이스를 알 수 있다.</li>\n<li><strong>Gateway로 다음 라우터 IP 주소를 알 수 있다!!!</strong></li>\n<li>가장 위 행은 기본 게이트웨이를 나타낸다 (추후 설명)</li>\n<li>어느 LAN 어댑터에서 보내는지 정하고 해당 IP 주소를 <strong>송신처 IP 주소</strong>로 설정한다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>IP 헤더에 어느 프로토콜 (TCP, UDP 등등)을 사용하는지 번호를 작성한다.</li>\n</ul>\n<h3 id=\"4-이더넷용-mac-헤더를-만든다\" style=\"position:relative;\"><a href=\"#4-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9A%A9-mac-%ED%97%A4%EB%8D%94%EB%A5%BC-%EB%A7%8C%EB%93%A0%EB%8B%A4\" aria-label=\"4 이더넷용 mac 헤더를 만든다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>4. 이더넷용 MAC 헤더를 만든다</h3>\n<p>MAC 헤더는 이더넷이 사용한다. </p>\n<ul>\n<li>수신처 MAC 주소, 송신처 MAC주소, 이더 타입(사용하는 프로토콜 종류 ARP, IP, IPv6 등등)</li>\n</ul>\n<h4 id=\"mac-주소-알아보기\" style=\"position:relative;\"><a href=\"#mac-%EC%A3%BC%EC%86%8C-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0\" aria-label=\"mac 주소 알아보기 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>MAC 주소 알아보기</h4>\n<ul>\n<li>MAC 주소는 48비트이다.</li>\n<li>\n<p>이더타입에 프로토콜 번호를 기입한다.</p>\n<ul>\n<li>이더넷의 경우 IP혹은 ARP이다.</li>\n</ul>\n</li>\n<li>송신처 MAC주소에 LAN 어댑터의 MAC 주소를 설정한다.</li>\n<li>\n<p>수신처의 MAC 주소를 조사해서 설정한다.</p>\n<ul>\n<li>경로표의 Gateway가 패킷을 건내줄 대상이다.</li>\n<li>이 IP 주소로 MAC 주소를 조사한다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"5-arp로-수신처-라우터의-mac-주소를-조사한다\" style=\"position:relative;\"><a href=\"#5-arp%EB%A1%9C-%EC%88%98%EC%8B%A0%EC%B2%98-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-mac-%EC%A3%BC%EC%86%8C%EB%A5%BC-%EC%A1%B0%EC%82%AC%ED%95%9C%EB%8B%A4\" aria-label=\"5 arp로 수신처 라우터의 mac 주소를 조사한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>5. ARP로 수신처 라우터의 MAC 주소를 조사한다</h3>\n<ul>\n<li>\n<p>이더넷에 브로드캐스를 통해 연결된 전원에게 xx IP 주소(게이트웨이의 IP 주소)를 물어봐서 MAC주소를 획득한다.</p>\n<ul>\n<li>상대가 자신과 같은 네트워크라면 이렇게 MAC주소를 알 수 있다. (Gateway가 라우터 IP 주소인 경우 라우터가 응답한다)</li>\n<li>해당하지 않는 기기는 브로드캐스트 메세지를 무시한다.</li>\n<li>ARP 응답이 없다면 패킷 송신 동작이 실패한다.</li>\n<li>\n<p>매번 ARP 패킷을 보내는 것은 어렵기 때문에 메모리에 ARP 캐시 데이터를 저장한다.</p>\n<ul>\n<li><code class=\"language-text\">arp -a</code> 를 통해 ARP 캐시데이터를 확인</li>\n<li><code class=\"language-text\">arp -d</code> 를 통해 캐시 데이터 삭제</li>\n<li>몇 분이 지나면 캐시 데이터를 삭제한다 → IP가 더이상 유효하지 않을수 있기 때문이다.</li>\n</ul>\n</li>\n<li>MAC 헤더를 붙이면 LAN 어댑터가 패킷을 그대로 송수신할 수 있다.</li>\n<li>MAC주소는 <code class=\"language-text\">:</code> 또는 <code class=\"language-text\">-</code>로 구분하며 총 48피트이고 8비트씩 16진수로 나타낸다.</li>\n</ul>\n</li>\n</ul>\n<h3 id=\"6-이더넷의-기본\" style=\"position:relative;\"><a href=\"#6-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9D%98-%EA%B8%B0%EB%B3%B8\" aria-label=\"6 이더넷의 기본 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>6. 이더넷의 기본</h3>\n<ul>\n<li><strong>이더넷은 컴퓨터가 여러 컴퓨터와 적은 비용으로 자유롭게 통신하기 위한 통신 기술이다.</strong></li>\n<li>원형은 하나의 케이블에 여러 컴퓨터가 연결이 되어 있어서 케이블로 전체에게 신호가 가고 MAC헤더를 통해 수신처를 판단하여 다른 대상들을 해당 패킷을 폐기하고 대상 컴퓨터만 패킷을 받게 되는 구조이다.</li>\n<li>\n<p>케이블 → 리피터 허브 → 스위칭 허브(현재 모습)으로 변화했다.</p>\n<ul>\n<li>전원에게 신호를 보내는 것이 아니라 MAC 주소로 알아낸 원하는 상대에게만 신호가 흐른다.</li>\n</ul>\n</li>\n<li>이더넷의 동작도 패킷의 내용과는 아무런 상관이 없다.</li>\n</ul>\n<h3 id=\"7-ip-패킷을-전기나-빛의-신호로-변환하여-송신한다\" style=\"position:relative;\"><a href=\"#7-ip-%ED%8C%A8%ED%82%B7%EC%9D%84-%EC%A0%84%EA%B8%B0%EB%82%98-%EB%B9%9B%EC%9D%98-%EC%8B%A0%ED%98%B8%EB%A1%9C-%EB%B3%80%ED%99%98%ED%95%98%EC%97%AC-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\" aria-label=\"7 ip 패킷을 전기나 빛의 신호로 변환하여 송신한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>7. IP 패킷을 전기나 빛의 신호로 변환하여 송신한다</h3>\n<ul>\n<li>LAN 어댑터가 디지털 데이터를 전기나 빛의 신호로 변환하여 네트워크 케이블에 송출한다.</li>\n<li>LAN 어댑터를 제어하는 LAN 드라이버라는 소프트웨어가 필요하다.</li>\n</ul>\n<h3 id=\"8-패킷에-3개-제어용-데이터를-추가한다\" style=\"position:relative;\"><a href=\"#8-%ED%8C%A8%ED%82%B7%EC%97%90-3%EA%B0%9C-%EC%A0%9C%EC%96%B4%EC%9A%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%B6%94%EA%B0%80%ED%95%9C%EB%8B%A4\" aria-label=\"8 패킷에 3개 제어용 데이터를 추가한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>8. 패킷에 3개 제어용 데이터를 추가한다</h3>\n<ul>\n<li>프리앰블, 스타트 프레임 딜리미터, 프레임 체크 시퀀스(오류 검출용 데이터)를 추가한다.</li>\n<li>프리앰플로 클록신호의 타이밍을 잡는다.</li>\n<li>스타트 프레임 딜리미터로 패킷 신호 시작을 나타낸다.</li>\n<li>FCS로 오류를 검출한다.</li>\n</ul>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543918-2a540179-7fd3-4416-8734-608fd29b9a72.png\"><br>출처: 상위 1% 네트워크</p>\n<p align=\"center\"><img width=\"70%\" src=\"https://user-images.githubusercontent.com/63405904/138543919-a2e6971b-983a-478d-9e55-a78d6aba5b40.png\"><br>출처: 상위 1% 네트워크</p>\n<h3 id=\"9-허브를-향해-패킷을-송신한다\" style=\"position:relative;\"><a href=\"#9-%ED%97%88%EB%B8%8C%EB%A5%BC-%ED%96%A5%ED%95%B4-%ED%8C%A8%ED%82%B7%EC%9D%84-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\" aria-label=\"9 허브를 향해 패킷을 송신한다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>9. 허브를 향해 패킷을 송신한다</h3>\n<ul>\n<li>리피터 허브의 반이중 모드 &#x26; 스위치 허브의 전이중 모드가 있다.</li>\n<li>\n<p>반이중 모드</p>\n<ul>\n<li>케이블에 다른 송신 동작이 흐르고 있으면 대기했다가 송신 동작을 시작한다.</li>\n<li>동시에 신호가 흐르면 충돌이 나며 재밍 신호를 보내고 송신 동작을 멈추고 잠시 후 다시 시작한다.</li>\n</ul>\n</li>\n<li>전이중 모드는 충돌이 일어나지 않는다. (추후 설명)</li>\n</ul>\n<h3 id=\"10-돌아온-패킷을-받는다\" style=\"position:relative;\"><a href=\"#10-%EB%8F%8C%EC%95%84%EC%98%A8-%ED%8C%A8%ED%82%B7%EC%9D%84-%EB%B0%9B%EB%8A%94%EB%8B%A4\" aria-label=\"10 돌아온 패킷을 받는다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>10. 돌아온 패킷을 받는다</h3>\n<ul>\n<li>리피터 허브에서는 한대에서 송신해도 전체에 신호가 간다. 이것을 모두 수신 신호로 받는다.</li>\n<li>프리앰블로 타이밍일 계산하고 스타트 프레임 딜리미터가 나오면 그 다음 비트부터 패킷으로 판단해 디지털 데이터로 변환한다. 최후에 FCS를 검사하여 오류가 있다면 폐기한다.</li>\n<li>오류가 없다면 MAC헤더 수신처와 MAC 주소를 조사하여 자신의 것이면 수신하여 버퍼 메모리에 저장하고 아니라면 패킷을 폐기한다.</li>\n<li>자신의 것이라서 패킷을 수신하면 <strong>interrupt 인터럽트</strong>로 컴퓨터에 통지한다.</li>\n</ul>\n<h3 id=\"11-서버의-응답-패킷을-ip에서-tcp로-넘긴다\" style=\"position:relative;\"><a href=\"#11-%EC%84%9C%EB%B2%84%EC%9D%98-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%84-ip%EC%97%90%EC%84%9C-tcp%EB%A1%9C-%EB%84%98%EA%B8%B4%EB%8B%A4\" aria-label=\"11 서버의 응답 패킷을 ip에서 tcp로 넘긴다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>11. 서버의 응답 패킷을 IP에서 TCP로 넘긴다</h3>\n<ul>\n<li>\n<p>웹서버에서 패킷이 돌아오면 (LAN 어댑터가 프로토콜 번호를 확인해 TCP/IP 프로토콜 스택으로 전송함) 프로토콜 스택의 IP 담당 부분에 넘겨진다.</p>\n<ul>\n<li>IP 헤더를 조사해 수신처 IP주소를 조사하여 LAN 어댑터와 일치하는지 확인하고 패킷을 수신한다.</li>\n<li>\n<p>만일 자신에게 온 패킷이 아니라면 IP 담당 부분이 <strong>ICMP 메세지로 통신 상대에게 오류를 통지</strong>한다.</p>\n<ul>\n<li>여러 메세지 종류가 있다.</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>\n<p>만일 패킷이 fragment로 분할된 것이면 IP 담당은 패킷을 복원한다. (이후에 패킷 분할에 대해서 다룬다)</p>\n<ul>\n<li>IP 헤더의 flag로 분할여부를 확인할 수 있다.</li>\n<li>ID 정보로 같은 패킷임을 확인할 수 있다.</li>\n<li>fragment offset으로 패킷 위치를 알 수 있다.</li>\n<li>패킷을 복원하는 동작 = reassembling 리어셈블링이라고 한다.</li>\n</ul>\n</li>\n<li>리어셈블링이 끝나면 패킷을 TCP 담당 부분에 넘긴다.</li>\n</ul>\n<br>\n<h2 id=\"🛺-story6-udp-프로토콜을-이용한-송수신동작\" style=\"position:relative;\"><a href=\"#%F0%9F%9B%BA-story6-udp-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%86%A1%EC%88%98%EC%8B%A0%EB%8F%99%EC%9E%91\" aria-label=\"🛺 story6 udp 프로토콜을 이용한 송수신동작 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>🛺 [Story6] UDP 프로토콜을 이용한 송수신동작</h2>\n<h3 id=\"1-수정송신이-필요없는-데이터-송신은-udp가-효율적이다\" style=\"position:relative;\"><a href=\"#1-%EC%88%98%EC%A0%95%EC%86%A1%EC%8B%A0%EC%9D%B4-%ED%95%84%EC%9A%94%EC%97%86%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%A1%EC%8B%A0%EC%9D%80-udp%EA%B0%80-%ED%9A%A8%EC%9C%A8%EC%A0%81%EC%9D%B4%EB%8B%A4\" aria-label=\"1 수정송신이 필요없는 데이터 송신은 udp가 효율적이다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>1. 수정송신이 필요없는 데이터 송신은 UDP가 효율적이다.</h3>\n<ul>\n<li>ex. DNS 서버에서 IP 주소를 조회할 때</li>\n<li>\n<p>만일 데이터를 보내서 수신응답이 오지 않으면 패킷을 전부 다 보내는 간단한 방법이 있다.</p>\n<ul>\n<li>하지만 그것을 비효율적이니 TCP가 누락된 부분만 보내기 위해서 복잡한 구조인 것이다.</li>\n</ul>\n</li>\n<li>패킷이 하나라면 복잡하게 생각하지 않고 회신이 오지 않으면 다시 보내면 된다.</li>\n</ul>\n<h3 id=\"2-제어용-짧은-데이터\" style=\"position:relative;\"><a href=\"#2-%EC%A0%9C%EC%96%B4%EC%9A%A9-%EC%A7%A7%EC%9D%80-%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"2 제어용 짧은 데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>2. 제어용 짧은 데이터</h3>\n<ul>\n<li>DNS 조회 같은 경우 패킷 1개로 가능한 짧은 요청이기 때문에 UDP를 사용한다.</li>\n<li>접속이나 연결 끊기 단계가 없이 송신 데이터에 UDP 헤더만 추가하여 바로 IP 담당에 의뢰하여 송신한다.</li>\n<li>만일 오류가 생기면 송신측에서 회답이 오지 않으므로 데이터를 한번 더 보낸다.</li>\n</ul>\n<h3 id=\"3-음성-및-동영상-데이터\" style=\"position:relative;\"><a href=\"#3-%EC%9D%8C%EC%84%B1-%EB%B0%8F-%EB%8F%99%EC%98%81%EC%83%81-%EB%8D%B0%EC%9D%B4%ED%84%B0\" aria-label=\"3 음성 및 동영상 데이터 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3. 음성 및 동영상 데이터</h3>\n<ul>\n<li>UDP를 많이 사용한다. 타이밍이 맞지 않으면 데이터가 다시 와도 쓸모가 없으므로 잠시 누락되어도 괜찮다.</li>\n</ul>\n<p><strong>⇒ 이 다음은 케이블로 나간 전기 및 빛 신호가 리피터 허브, 스위칭 허브, 라우터 기기를 통해 인터넷으로 나가는 과정이다.</strong> </p>\n<br>\n<br>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">[용어]\n\nARP - Address Resolution Protocol\n\nFCS - Frame Check Sequence</code></pre></div>\n<div class=\"table-of-contents\">\n<ul>\n<li>\n<p><a href=\"#%F0%9F%9B%BA-story4-%EC%84%9C%EB%B2%84%EC%97%90%EC%84%9C-%EC%97%B0%EA%B2%B0%EC%9D%84-%EB%81%8A%EC%96%B4-%EC%86%8C%EC%BC%93%EC%9D%84-%EB%A7%90%EC%86%8C%ED%95%9C%EB%8B%A4\">🛺 Story4 서버에서 연결을 끊어 소켓을 말소한다</a></p>\n<ul>\n<li><a href=\"#1-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%B3%B4%EB%82%B4%EA%B8%B0%EB%A5%BC-%EC%99%84%EB%A3%8C%ED%95%98%EA%B3%A0-%EC%97%B0%EA%B2%B0%EC%9D%84-%EB%81%8A%EB%8A%94%EB%8B%A4\">1. 데이터 보내기를 완료하고 연결을 끊는다</a></li>\n<li><a href=\"#2-%EC%86%8C%EC%BC%93%EC%9D%84-%EB%A7%90%EC%86%8C%ED%95%9C%EB%8B%A4\">2. 소켓을 말소한다</a></li>\n<li><a href=\"#3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91-%EC%9A%94%EC%95%BD\">3. 데이터 송수신 동작 요약</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%F0%9F%9B%BA-story5-ip%EC%99%80-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9D%98-%ED%8C%A8%ED%82%B7-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91\">🛺 Story5 IP와 이더넷의 패킷 송수신 동작</a></p>\n<ul>\n<li>\n<p><a href=\"#1-%ED%8C%A8%ED%82%B7%EC%9D%98-%EA%B8%B0%EB%B3%B8\">1. 패킷의 기본</a></p>\n<ul>\n<li><a href=\"#tcpip-%EC%97%90%EC%84%9C-%ED%8C%A8%ED%82%B7-%EA%B5%AC%EC%A1%B0\">TCP/IP 에서 패킷 구조</a></li>\n</ul>\n</li>\n<li><a href=\"#2-%ED%8C%A8%ED%82%B7-%EC%86%A1%EC%88%98%EC%8B%A0-%EB%8F%99%EC%9E%91%EC%9D%98-%EA%B0%9C%EC%9A%94\">2. 패킷 송수신 동작의 개요</a></li>\n<li>\n<p><a href=\"#3-%EC%88%98%EC%8B%A0%EC%B2%98-ip%EC%A3%BC%EC%86%8C%EB%A5%BC-%EA%B8%B0%EB%A1%9D%ED%95%9C-ip-%ED%97%A4%EB%8D%94%EB%A5%BC-%EB%A7%8C%EB%93%A0%EB%8B%A4\">3. 수신처 IP주소를 기록한 IP 헤더를 만든다</a></p>\n<ul>\n<li><a href=\"#ip-%EA%B2%BD%EB%A1%9C%ED%91%9C\">IP 경로표</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#4-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9A%A9-mac-%ED%97%A4%EB%8D%94%EB%A5%BC-%EB%A7%8C%EB%93%A0%EB%8B%A4\">4. 이더넷용 MAC 헤더를 만든다</a></p>\n<ul>\n<li><a href=\"#mac-%EC%A3%BC%EC%86%8C-%EC%95%8C%EC%95%84%EB%B3%B4%EA%B8%B0\">MAC 주소 알아보기</a></li>\n</ul>\n</li>\n<li><a href=\"#5-arp%EB%A1%9C-%EC%88%98%EC%8B%A0%EC%B2%98-%EB%9D%BC%EC%9A%B0%ED%84%B0%EC%9D%98-mac-%EC%A3%BC%EC%86%8C%EB%A5%BC-%EC%A1%B0%EC%82%AC%ED%95%9C%EB%8B%A4\">5. ARP로 수신처 라우터의 MAC 주소를 조사한다</a></li>\n<li><a href=\"#6-%EC%9D%B4%EB%8D%94%EB%84%B7%EC%9D%98-%EA%B8%B0%EB%B3%B8\">6. 이더넷의 기본</a></li>\n<li><a href=\"#7-ip-%ED%8C%A8%ED%82%B7%EC%9D%84-%EC%A0%84%EA%B8%B0%EB%82%98-%EB%B9%9B%EC%9D%98-%EC%8B%A0%ED%98%B8%EB%A1%9C-%EB%B3%80%ED%99%98%ED%95%98%EC%97%AC-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\">7. IP 패킷을 전기나 빛의 신호로 변환하여 송신한다</a></li>\n<li><a href=\"#8-%ED%8C%A8%ED%82%B7%EC%97%90-3%EA%B0%9C-%EC%A0%9C%EC%96%B4%EC%9A%A9-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%A5%BC-%EC%B6%94%EA%B0%80%ED%95%9C%EB%8B%A4\">8. 패킷에 3개 제어용 데이터를 추가한다</a></li>\n<li><a href=\"#9-%ED%97%88%EB%B8%8C%EB%A5%BC-%ED%96%A5%ED%95%B4-%ED%8C%A8%ED%82%B7%EC%9D%84-%EC%86%A1%EC%8B%A0%ED%95%9C%EB%8B%A4\">9. 허브를 향해 패킷을 송신한다</a></li>\n<li><a href=\"#10-%EB%8F%8C%EC%95%84%EC%98%A8-%ED%8C%A8%ED%82%B7%EC%9D%84-%EB%B0%9B%EB%8A%94%EB%8B%A4\">10. 돌아온 패킷을 받는다</a></li>\n<li><a href=\"#11-%EC%84%9C%EB%B2%84%EC%9D%98-%EC%9D%91%EB%8B%B5-%ED%8C%A8%ED%82%B7%EC%9D%84-ip%EC%97%90%EC%84%9C-tcp%EB%A1%9C-%EB%84%98%EA%B8%B4%EB%8B%A4\">11. 서버의 응답 패킷을 IP에서 TCP로 넘긴다</a></li>\n</ul>\n</li>\n<li>\n<p><a href=\"#%F0%9F%9B%BA-story6-udp-%ED%94%84%EB%A1%9C%ED%86%A0%EC%BD%9C%EC%9D%84-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%86%A1%EC%88%98%EC%8B%A0%EB%8F%99%EC%9E%91\">🛺 Story6 UDP 프로토콜을 이용한 송수신동작</a></p>\n<ul>\n<li><a href=\"#1-%EC%88%98%EC%A0%95%EC%86%A1%EC%8B%A0%EC%9D%B4-%ED%95%84%EC%9A%94%EC%97%86%EB%8A%94-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EC%86%A1%EC%8B%A0%EC%9D%80-udp%EA%B0%80-%ED%9A%A8%EC%9C%A8%EC%A0%81%EC%9D%B4%EB%8B%A4\">1. 수정송신이 필요없는 데이터 송신은 UDP가 효율적이다.</a></li>\n<li><a href=\"#2-%EC%A0%9C%EC%96%B4%EC%9A%A9-%EC%A7%A7%EC%9D%80-%EB%8D%B0%EC%9D%B4%ED%84%B0\">2. 제어용 짧은 데이터</a></li>\n<li><a href=\"#3-%EC%9D%8C%EC%84%B1-%EB%B0%8F-%EB%8F%99%EC%98%81%EC%83%81-%EB%8D%B0%EC%9D%B4%ED%84%B0\">3. 음성 및 동영상 데이터</a></li>\n</ul>\n</li>\n</ul>\n</div>","frontmatter":{"date":"September 30, 2021","title":"성공과 실패를 결정하는 1%의 네트워크 원리_4","categories":"네트워크 책","author":"코다","emoji":"⚡️"},"fields":{"slug":"/one-percent-network-4/"}},"prev":{"id":"f536d063-bb0a-5d8a-89be-12abd97a0c4e","html":"<h2 id=\"intro\" style=\"position:relative;\"><a href=\"#intro\" aria-label=\"intro permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Intro</h2>\n<ul>\n<li>JPA의 <code class=\"language-text\">fetch join</code> 사용시 별칭을 쓰면 안되는 이유가 무엇인지 알아본다. </li>\n<li><a href=\"https://github.com/woowacourse-teams/2021-pick-git\">프로젝트</a>애서 fetch join 시 별칭 사용에 대해서 고민해본다. </li>\n</ul>\n<br>\n<h2 id=\"fetch-join-별칭은-왜-안될까-\" style=\"position:relative;\"><a href=\"#fetch-join-%EB%B3%84%EC%B9%AD%EC%9D%80-%EC%99%9C-%EC%95%88%EB%90%A0%EA%B9%8C-\" aria-label=\"fetch join 별칭은 왜 안될까  permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>fetch join 별칭은 왜 안될까 ?</h2>\n<ul>\n<li>fetch join에서 별칭이 안되는 이유는 데이터의 일관성이 깨지기 때문이다.</li>\n<li>\n<p>예를 들어서 다음과 같은 코드는 fetch join 대상에 조건문이 들어가서 일관성이 깨진 경우이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@DisplayName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"fetch join 대상에 조건문을 걸었을 때 데이터가 불일치하다.\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> <span class=\"token function\">findTeamWithSpecificNameMember</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token comment\">// given</span>\n\n    <span class=\"token comment\">// 데이터 삽입</span>\n    <span class=\"token class-name\">Team</span> teamA <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Team</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"teamA\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">Member</span> memberA1 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberA1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Member</span> memberA2 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberA2\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">Member</span> memberA3 <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Member</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberA3\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Member</span><span class=\"token punctuation\">></span></span> teamAMembers <span class=\"token operator\">=</span> <span class=\"token class-name\">List</span><span class=\"token punctuation\">.</span><span class=\"token function\">of</span><span class=\"token punctuation\">(</span>memberA1<span class=\"token punctuation\">,</span> memberA2<span class=\"token punctuation\">,</span> memberA3<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    teamA<span class=\"token punctuation\">.</span><span class=\"token function\">setMembers</span><span class=\"token punctuation\">(</span>teamAMembers<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    teamRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>teamA<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    testEntityManager<span class=\"token punctuation\">.</span><span class=\"token function\">flush</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    testEntityManager<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 데이터 조회</span>\n    <span class=\"token class-name\">Team</span> teamA <span class=\"token operator\">=</span> teamRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span><span class=\"token number\">1L</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">int</span> teamAMemberSize <span class=\"token operator\">=</span> teamA<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    testEntityManager<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// when</span>\n    <span class=\"token class-name\">Team</span> teamAWithMemberName <span class=\"token operator\">=</span> teamRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findTeamWithSomeMemberByName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"memberA1\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// then</span>\n    <span class=\"token comment\">/* 본래 teamA에 3명의 멤버가 들어가있지만 fetch join 대상에 where문이 들어가면서 데이터 불일치가 일어났다.\n    * collection 에는 관련 데이터가 모두 들어가있기를 기대하는데 그렇지 않다.\n    * 따라서 fetch join 대상에 필터링 조건을 거는 것을 지양한다. \n    */</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>teamA<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span>teamAWithMemberName<span class=\"token punctuation\">.</span><span class=\"token function\">getName</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>teamAMemberSize<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isNotEqualTo</span><span class=\"token punctuation\">(</span>teamAWithMemberName<span class=\"token punctuation\">.</span><span class=\"token function\">getMembers</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>TeamA에 대한 member collection 은 본래 3개이다. 그리고 fetch join을 하면 연관된 데이터가 모두 들어올 것이라고 가정한다. </li>\n<li>하지만 위와 같이 fetch join 대상에 별칭을 주어 where 필터링 조건을 사용하면 실제로 TeamA에 연관된 멤버는 3명이지만 <code class=\"language-text\">memberA1</code>만 연관 데이터로 들어온다. </li>\n<li>DB의 상태에 대한 일관성이 깨진다. </li>\n</ul>\n<h3 id=\"하지만-예외는-있다\" style=\"position:relative;\"><a href=\"#%ED%95%98%EC%A7%80%EB%A7%8C-%EC%98%88%EC%99%B8%EB%8A%94-%EC%9E%88%EB%8B%A4\" aria-label=\"하지만 예외는 있다 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>하지만 예외는 있다</h3>\n<ul>\n<li>일관성을 해치지지 않는 한에서 성능에 도움이 된다면 예외적으로 사용해도 된다. (아마도 하이버네이트가 별칭을 허용하는 이유…)</li>\n<li>\n<p>예를 들어 다음과 같은 쿼리는 일관성을 해치지 않는다. </p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">select</span> m <span class=\"token keyword\">from</span> Member m <span class=\"token keyword\">join</span> <span class=\"token keyword\">fetch</span> m<span class=\"token punctuation\">.</span>team <span class=\"token keyword\">where</span> t<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> :teamName</code></pre></div>\n</li>\n<li>하지만 위의 쿼리가 left join fetch로 되면 일관성이 깨진다. (Team이 null이 아닌 Member에 대해서 null 값이 들어가기 때문이다.)</li>\n<li>때문에 매우 조심스럽게 사용해야한다. </li>\n</ul>\n<br>\n<h2 id=\"우리-프로젝트에-있는-별칭은\" style=\"position:relative;\"><a href=\"#%EC%9A%B0%EB%A6%AC-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90-%EC%9E%88%EB%8A%94-%EB%B3%84%EC%B9%AD%EC%9D%80\" aria-label=\"우리 프로젝트에 있는 별칭은 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>우리 프로젝트에 있는 별칭은?!</h2>\n<ul>\n<li>\n<p>깃들다 프로젝트에도 fetch join 대상에 별칭을 사용하는 부분이 있다. 다음 <a href=\"http://tech.pick-git.com/jpa-proxy-equals-bug/\">포스트</a>에 어떤 상황이었는지 배경 설명이 자세하게 되어있다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Query</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"select distinct p from Post p left join fetch p.likes.likes l left join fetch l.user where p.id = :postId\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token class-name\">Optional</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Post</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">findPostWithLikeUsers</span><span class=\"token punctuation\">(</span><span class=\"token annotation punctuation\">@Param</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"postId\"</span><span class=\"token punctuation\">)</span> <span class=\"token class-name\">Long</span> postId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n</li>\n<li>\n<p>Post 안에는 해당 게시물을 좋아요한 유저들 정보를 담은 <code class=\"language-text\">Like</code> 리스트가 담겨있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Post</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token comment\">//....</span>\n\n <span class=\"token annotation punctuation\">@OneToMany</span><span class=\"token punctuation\">(</span>\n    mappedBy <span class=\"token operator\">=</span> <span class=\"token string\">\"post\"</span><span class=\"token punctuation\">,</span>\n    fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">,</span>\n    cascade <span class=\"token operator\">=</span> <span class=\"token class-name\">CascadeType</span><span class=\"token punctuation\">.</span>PERSIST<span class=\"token punctuation\">,</span>\n    orphanRemoval <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span>\n<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Like</span><span class=\"token punctuation\">></span></span> likes<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Like</span> <span class=\"token punctuation\">{</span>\n\n<span class=\"token annotation punctuation\">@Id</span> <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span>IDENTITY<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"post_id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">Post</span> post<span class=\"token punctuation\">;</span>\n\n<span class=\"token annotation punctuation\">@ManyToOne</span><span class=\"token punctuation\">(</span>fetch <span class=\"token operator\">=</span> <span class=\"token class-name\">FetchType</span><span class=\"token punctuation\">.</span>LAZY<span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@JoinColumn</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">private</span> <span class=\"token class-name\">User</span> user<span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">//...</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n</li>\n<li>\n<p>위 쿼리를 살펴보면 </p>\n<ul>\n<li>별칭이 <code class=\"language-text\">p.likes.likes l</code>에 사용된다. </li>\n<li>where 조건문에는 fetch join 대상을 필터링 하지 않는다. </li>\n<li>따라서 데이터 일관성을 헤치지 않는다.</li>\n</ul>\n</li>\n<li>fetch join을 할 때 주의해야하는 부분은 collection을 여러개 fetch join 할 경우이다. </li>\n<li>위 같은 경우는 <code class=\"language-text\">post -> like</code> 관계는 OneToMany라서 한번까지 fetch join 할 수 있다. </li>\n<li><code class=\"language-text\">like -> user</code>는 ManyToOne 관계 이므로 추가 fetch join을 할 수 있었다. </li>\n</ul>\n<br>\n<h2 id=\"마무리\" style=\"position:relative;\"><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\" aria-label=\"마무리 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>마무리</h2>\n<ul>\n<li>처음에 버그를 마주하고 fetch join 대상에 별칭을 두는 것이 찝찝했지만 왜 안되는지 모르는 상태로 (나만) 넘어갔다.</li>\n<li>검토해보니 fetch join 대상이 아니었으며 여러 collection을 fetch join 하는 상황도 아니었다. </li>\n<li>하지만 이런 예외적인 경우는 자세히 알아보고 주의해서 사용해야 할 것 같다. 또 왜인지 모르고 그냥 안쓰지는 말자. </li>\n</ul>\n<div class=\"table-of-contents\">\n<ul>\n<li><a href=\"#intro\">Intro</a></li>\n<li>\n<p><a href=\"#fetch-join-%EB%B3%84%EC%B9%AD%EC%9D%80-%EC%99%9C-%EC%95%88%EB%90%A0%EA%B9%8C-\">fetch join 별칭은 왜 안될까 ?</a></p>\n<ul>\n<li><a href=\"#%ED%95%98%EC%A7%80%EB%A7%8C-%EC%98%88%EC%99%B8%EB%8A%94-%EC%9E%88%EB%8B%A4\">하지만 예외는 있다</a></li>\n</ul>\n</li>\n<li><a href=\"#%EC%9A%B0%EB%A6%AC-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EC%97%90-%EC%9E%88%EB%8A%94-%EB%B3%84%EC%B9%AD%EC%9D%80\">우리 프로젝트에 있는 별칭은?!</a></li>\n<li><a href=\"#%EB%A7%88%EB%AC%B4%EB%A6%AC\">마무리</a></li>\n</ul>\n</div>","frontmatter":{"date":"October 06, 2021","title":"JPA 에서 별칭을 쓰지 않는 이유 (하지만 쓴 이유)","categories":"JPA 프로젝트","author":"코다","emoji":"🚀"},"fields":{"slug":"/jpa-fetch-join-nickname/"}},"site":{"siteMetadata":{"siteUrl":"https://yjksw.github.io","comments":{"utterances":{"repo":"yjksw/yjksw.github.io"}}}}},"pageContext":{"slug":"/one-percent-network-5/","nextSlug":"/one-percent-network-4/","prevSlug":"/jpa-fetch-join-nickname/"}},"staticQueryHashes":["1073350324","2938748437"]}